"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8066],{8066:function(e,t,s){s.r(t),s.d(t,{default:function(){return w}});var n=s(5893),a=s(9774),i=s(1955),r=s(4554),o=s(6789),l=s(9321),c=s(6490),d=s(1664),x=s.n(d),f=s(6606),h=s.n(f),u=s(7294),m=s(7421),p=s(7249),g=s(9681),j=s(7327),b=s(9827),v=s(7776),N=s(1956),y=s(7259),_=s(4309);function w(){let{sendNotification:e}=(0,_.lm)(),t=(0,g.x)(),{t:s,i18n:d}=(0,m.$G)("common"),f=new Audio("/assets/sound/notification.mp3"),[w,k]=(0,u.useState)([]),z=async e=>{setTimeout(()=>{e.forEach(e=>{e.seen_at||a.dJ.post("/notifications/seen",{notification_id:e.notification_id})})},1e3)};(0,u.useEffect)(()=>{let t=i.Z.get("currentUser"),s=[];a.dJ.get("/notifications/unread").then(t=>{s=t.data,k(t.data),JSON.parse(JSON.stringify(s)).reverse().forEach(t=>{t.seen_at||e(t)}),z(s)});let n=new r.ZP({broadcaster:"pusher",key:"liman-key",cluster:"eu",wsHost:window.location.host,wssPort:443,disableStats:!0,encrypted:!0,enabledTransports:["ws","wss"],disabledTransports:["sockjs","xhr_polling","xhr_streaming"],authEndpoint:"/api/broadcasting/auth",auth:{headers:{Accept:"application/json"}},pusher:h()});return n.private("App.Models.User.".concat(JSON.parse(t).user.id)).notification(t=>{k([t,...s]),s=JSON.parse(JSON.stringify([t,...s])),f.play(),e(t),z([t])}),()=>{n.leave("App.Models.User.".concat(JSON.parse(t).user.id)),n.disconnect()}},[]);let J=()=>{a.dJ.post("/notifications/read").then(()=>{k([])})};return(0,n.jsxs)(v.h_,{children:[(0,n.jsx)(v.$F,{asChild:!0,children:(0,n.jsxs)("div",{className:(0,j.cn)((0,p.d)({size:"sm",variant:"ghost"}),"relative"),children:[(0,n.jsx)(o.Z,{className:"size-5"}),(0,n.jsx)("span",{className:"sr-only",children:"Notifications"}),w.filter(e=>!e.seen_at).length>0&&(0,n.jsx)(b.C,{className:"absolute right-0 top-0 rounded-full px-[4px] py-[2px] text-[11px] leading-[11px]",children:w.filter(e=>!e.seen_at).length})]})}),(0,n.jsxs)(v.AW,{className:"mr-5 w-[500px]",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between p-4",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold tracking-tight",children:s("notifications.title")}),(0,n.jsxs)(p.z,{variant:"ghost",size:"sm",className:"-mr-2 text-sm text-blue-500",disabled:0===w.length,onClick:()=>J(),children:[(0,n.jsx)(l.Z,{className:"mr-2 size-5"})," ",s("notifications.mark_all_as_read")]})]}),(0,n.jsx)(N.x,{type:"always",className:"flex flex-col gap-3 p-2 h-[350px]",children:w.map(e=>(0,n.jsx)(x(),{href:"/notifications#notification-".concat(e.notification_id),children:(0,n.jsxs)("div",{className:"relative flex flex-col gap-1 rounded p-2 transition-all hover:bg-accent/50 hover:text-accent-foreground",children:[(0,n.jsx)("h3",{className:"text-[15px] font-semibold tracking-tight",children:e.title}),(0,n.jsx)("p",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:e.content}),(0,n.jsx)("div",{className:"absolute right-2 top-1",children:(0,n.jsx)(y.Z,{status:e.level})}),(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("div",{className:"text-xs text-slate-700 dark:text-slate-400",children:new Date(e.send_at).toLocaleDateString(d.language,{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})}),(0,n.jsx)("span",{className:"text-xs text-slate-500",children:e.send_at_humanized})]})]})},e.notification_id))}),0===w.length&&(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center p-2 py-8",children:[(0,n.jsx)(c.Z,{className:"mb-5 size-8 text-slate-800 dark:text-slate-300"}),(0,n.jsx)("h3",{className:"text-md mb-1 font-semibold tracking-tight",children:s("notifications.empty")}),(0,n.jsx)("p",{className:"mb-[3px] text-sm text-slate-700 dark:text-slate-300",children:s("notifications.empty_message")})]})}),(0,n.jsx)(v.VD,{}),(0,n.jsxs)("div",{className:"flex items-center justify-between p-3",children:[1===t.status?(0,n.jsx)(x(),{href:"/settings/external_notifications",children:(0,n.jsx)(p.z,{size:"sm",variant:"ghost",className:"-ml-1 text-muted-foreground",children:s("notifications.manage")})}):(0,n.jsx)("div",{}),(0,n.jsx)(x(),{href:"/notifications",children:(0,n.jsx)(p.z,{size:"sm",className:"rounded-[8px]",children:s("notifications.show_all")})})]})]})]})}},9827:function(e,t,s){s.d(t,{C:function(){return o}});var n=s(5893);s(7294);var a=s(5139),i=s(7327);let r=(0,a.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",success:"border-transparent bg-green-500 text-white hover:bg-green-500/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function o(e){let{className:t,variant:s,...a}=e;return(0,n.jsx)("div",{className:(0,i.cn)(r({variant:s}),t),...a})}}}]);